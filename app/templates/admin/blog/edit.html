{% extends "admin/base.html" %}

{% block title %}{{ 'Edit' if post else 'New' }} Post{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Edit Post' if post else 'New Post' }}</h1>
        <a href="/admin/blog" class="text-sm text-gray-600 dark:text-gray-400 hover:underline">Back to posts</a>
    </div>

    <form method="post" action="{{ '/admin/blog/' ~ post.id ~ '/edit' if post else '/admin/blog/new' }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main content (left 2/3) -->
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-4">
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
                        <input type="text" id="title" name="title" required
                               value="{{ post.title if post else '' }}"
                               class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <div>
                        <label for="slug" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Slug</label>
                        <div class="flex items-center">
                            <span class="text-sm text-gray-500 dark:text-gray-400 mr-1">/blog/</span>
                            <input type="text" id="slug" name="slug" required
                                   value="{{ post.slug if post else '' }}"
                                   class="flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <div>
                        <label for="excerpt" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Excerpt</label>
                        <textarea id="excerpt" name="excerpt" rows="2"
                                  class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ post.excerpt if post else '' }}</textarea>
                    </div>

                    <div>
                        <label for="content" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Content (Markdown)</label>
                        <textarea id="content" name="content" rows="20" required
                                  class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ post.content if post else '' }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Sidebar (right 1/3) -->
            <div class="space-y-6">
                <!-- Publish settings -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-4">
                    <h2 class="text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider">Publish</h2>

                    <div class="flex items-center">
                        <input type="checkbox" id="published" name="published" value="true"
                               {% if post and post.published %}checked{% endif %}
                               class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
                        <label for="published" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Published</label>
                    </div>

                    <div class="flex items-center">
                        <input type="checkbox" id="featured" name="featured" value="true"
                               {% if post and post.featured %}checked{% endif %}
                               class="w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
                        <label for="featured" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Featured</label>
                    </div>

                    <button type="submit"
                            class="w-full px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors">
                        {{ 'Update Post' if post else 'Create Post' }}
                    </button>
                </div>

                <!-- Tags -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-4">
                    <h2 class="text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider">Tags</h2>
                    <div>
                        <input type="text" id="tags" name="tags"
                               value="{{ post.tags_list | join(', ') if post and post.tags_list else '' }}"
                               placeholder="Python, FastAPI, Web Dev"
                               class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Comma-separated</p>
                    </div>
                </div>

                <!-- SEO -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-4">
                    <h2 class="text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider">SEO</h2>
                    <div>
                        <label for="meta_description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Meta Description</label>
                        <textarea id="meta_description" name="meta_description" rows="3"
                                  class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{ post.meta_description if post else '' }}</textarea>
                    </div>
                    <div>
                        <label for="author" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Author</label>
                        <input type="text" id="author" name="author"
                               value="{{ post.author if post else 'Brian Hardin' }}"
                               class="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    // Auto-generate slug from title
    const titleInput = document.getElementById('title');
    const slugInput = document.getElementById('slug');
    let slugManuallyEdited = {{ 'true' if post else 'false' }};

    slugInput.addEventListener('input', function() {
        slugManuallyEdited = true;
    });

    titleInput.addEventListener('input', function() {
        if (!slugManuallyEdited) {
            slugInput.value = titleInput.value
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/[-\s]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }
    });
</script>
{% endblock %}
